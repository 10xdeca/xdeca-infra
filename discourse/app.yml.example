## Discourse standalone config for Podman
## Copy to containers/app.yml after cloning discourse_docker

templates:
  - "templates/postgres.template.yml"
  - "templates/redis.template.yml"
  - "templates/web.template.yml"
  - "templates/web.ratelimited.template.yml"

expose:
  - "8888:80"   # Caddy proxies to this port

params:
  db_default_text_search_config: "pg_catalog.english"

env:
  LC_ALL: en_US.UTF-8
  LANG: en_US.UTF-8
  LANGUAGE: en_US.UTF-8

  ## Domain
  DISCOURSE_HOSTNAME: discourse.example.com

  ## Admin email (first user becomes admin)
  DISCOURSE_DEVELOPER_EMAILS: 'admin@example.com'

  ## SMTP - Required for email verification
  DISCOURSE_SMTP_ADDRESS: smtp.mailgun.org
  DISCOURSE_SMTP_PORT: 587
  DISCOURSE_SMTP_USER_NAME: postmaster@mg.example.com
  DISCOURSE_SMTP_PASSWORD: your-smtp-password
  DISCOURSE_SMTP_ENABLE_START_TLS: true
  DISCOURSE_SMTP_DOMAIN: example.com
  DISCOURSE_NOTIFICATION_EMAIL: noreply@example.com

  ## Memory settings (adjust based on available RAM)
  UNICORN_WORKERS: 2
  DISCOURSE_MAX_REQS_PER_IP_PER_MINUTE: 200
  DISCOURSE_MAX_REQS_PER_IP_MODE: warn

volumes:
  - volume:
      host: /var/discourse/shared/standalone
      guest: /shared
  - volume:
      host: /var/discourse/shared/standalone/log/var-log
      guest: /var/log

hooks:
  after_code:
    - exec:
        cd: $home/plugins
        cmd:
          - git clone https://github.com/discourse/docker_manager.git
